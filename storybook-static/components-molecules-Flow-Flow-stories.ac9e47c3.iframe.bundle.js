(self.webpackChunkteamenver=self.webpackChunkteamenver||[]).push([[729],{"./src/components/molecules/Flow/Flow.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,default:()=>Flow_stories});var defineProperty=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),asyncToGenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),regenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.15/node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),dist=__webpack_require__("./node_modules/.pnpm/@storybook+testing-library@0.2.0/node_modules/@storybook/testing-library/dist/index.mjs"),slicedToArray=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),esm=__webpack_require__("./node_modules/.pnpm/@reactflow+core@11.7.4_@types+react@18.2.22_react-dom@18.2.0_react@18.2.0/node_modules/@reactflow/core/dist/esm/index.js"),dist_esm=__webpack_require__("./node_modules/.pnpm/@reactflow+controls@11.1.15_@types+react@18.2.22_react-dom@18.2.0_react@18.2.0/node_modules/@reactflow/controls/dist/esm/index.js"),minimap_dist_esm=__webpack_require__("./node_modules/.pnpm/@reactflow+minimap@11.5.4_@types+react@18.2.22_react-dom@18.2.0_react@18.2.0/node_modules/@reactflow/minimap/dist/esm/index.js"),background_dist_esm=__webpack_require__("./node_modules/.pnpm/@reactflow+background@11.2.4_@types+react@18.2.22_react-dom@18.2.0_react@18.2.0/node_modules/@reactflow/background/dist/esm/index.js"),css=(__webpack_require__("./node_modules/.pnpm/reactflow@11.7.4_@types+react@18.2.22_react-dom@18.2.0_react@18.2.0/node_modules/reactflow/dist/style.css"),__webpack_require__("./styled-system/css/index.mjs")),client=__webpack_require__("./src/services/client/index.ts"),path=(0,client.ho)("/get/topics"),getTopics=function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(query){return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",fetch("".concat(path,"?query=").concat(query),{headers:client.B}).then(client.$x));case 1:case"end":return _context.stop()}}),_callee)})));return function getTopics(_x){return _ref.apply(this,arguments)}}(),UpdateBoardDetail_path=(0,client.ho)("/edit/board"),updateBoardDetail=function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(category,label){return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",fetch("".concat(UpdateBoardDetail_path,"?category=").concat(category,"&label=").concat(label),{headers:client.B}).then(client.$x));case 1:case"end":return _context.stop()}}),_callee)})));return function updateBoardDetail(_x,_x2){return _ref.apply(this,arguments)}}(),dndNode=(0,css.jS)({base:{height:"20px",padding:"4px",border:"1px solid #1a192b",borderRadius:"2px",marginBottom:"10px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"grab"},variants:{type:{input:{borderColor:"#0041d0"},output:{borderColor:"#ff0072"},default:{borderColor:"gray"}}}}),__jsx=react.createElement,SideBar=function SideBar(_ref){var frameworks=_ref.frameworks,_useState=(0,react.useState)(!0),loading=_useState[0],setLoading=_useState[1],_useState2=(0,react.useState)(frameworks),libraries=_useState2[0],setLibraries=_useState2[1],fetchData=function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(prevCategory){var categories,prevCategoryId,nextCategory,_json$topic,_json$topic2,json,nodes,data;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(prevCategoryId=(categories=["framework","css-framework","ui-framework","linter","formatter","lint_staged_husky","hygen","builder","manager","vscode","volta","isGit"]).indexOf(prevCategory),nextCategory=categories[prevCategoryId+1],-1==categories.slice(0,3).indexOf(nextCategory)){_context.next=13;break}return _context.next=7,getTopics(nextCategory);case 7:return json=_context.sent,nodes=null===(_json$topic=json.topic)||void 0===_json$topic||null===(_json$topic=_json$topic.repositories.nodes)||void 0===_json$topic?void 0:_json$topic.map((function(node){return{name:null==node?void 0:node.name}})),data=JSON.stringify({name:null===(_json$topic2=json.topic)||void 0===_json$topic2?void 0:_json$topic2.name,nodes}),_context.abrupt("return",data);case 13:_context.t0=nextCategory,_context.next="builder"===_context.t0?16:"manager"===_context.t0?17:"isGit"===_context.t0?18:19;break;case 16:return _context.abrupt("return",JSON.stringify({name:nextCategory,nodes:[{name:"vite"},{name:"already using different builder"}]}));case 17:return _context.abrupt("return",JSON.stringify({name:nextCategory,nodes:[{name:"npm"},{name:"yarn"},{name:"pnpm"},{name:"bun"}]}));case 18:return _context.abrupt("return",JSON.stringify({name:nextCategory,nodes:[{name:"true"},{name:"false"}]}));case 19:return _context.abrupt("return",JSON.stringify({name:nextCategory,nodes:[{name:"yes"},{name:"no"},{name:"template"}]}));case 20:case"end":return _context.stop()}}),_callee)})));return function fetchData(_x){return _ref2.apply(this,arguments)}}(),_onDragStart=function(){var _ref3=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(event,nodeInfo){var data,libs;return regenerator_default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(event.dataTransfer.setData("application/reactflow",JSON.stringify(nodeInfo)),event.dataTransfer.effectAllowed="move","default"!==nodeInfo.type){_context2.next=12;break}return setLoading(!1),_context2.next=6,updateBoardDetail(nodeInfo.category,nodeInfo.label);case 6:return _context2.next=8,fetchData(nodeInfo.category?nodeInfo.category:"");case 8:data=_context2.sent,libs=JSON.parse(data),setLibraries(libs),setLoading(!0);case 12:case"end":return _context2.stop()}}),_callee2)})));return function onDragStart(_x2,_x3){return _ref3.apply(this,arguments)}}();return __jsx("aside",{className:(0,css.iv)({borderRight:"1px solid #eee",padding:"15px 10px",fontSize:"12px",background:"#fcfcfc",md:{width:"20%",maxWidth:"250px"}})},__jsx("div",{className:(0,css.iv)({marginBottom:"10px"})},__jsx("p",{className:(0,css.iv)({color:"red"})},"Choose how you apply ",libraries.name,"."),"You can drag these nodes to the pane on the left."),libraries.nodes.map((function(lb,index){return __jsx("div",{className:dndNode({type:"default"}),onDragStart:function onDragStart(event){return _onDragStart(event,{type:"default",category:libraries.name,label:lb.name})},draggable:loading,key:index},lb.name)})),__jsx("div",{className:dndNode({type:"output"}),onDragStart:function onDragStart(event){return _onDragStart(event,{type:"output",label:"Output"})},draggable:loading},"Output"))};SideBar.displayName="SideBar",SideBar.__docgenInfo={description:"",methods:[],displayName:"SideBar",props:{frameworks:{required:!0,tsType:{name:"sidebarData"},description:""}}};try{SideBar.displayName="SideBar",SideBar.__docgenInfo={description:"",displayName:"SideBar",props:{frameworks:{defaultValue:null,description:"",name:"frameworks",required:!0,type:{name:"sidebarData"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/molecules/Flow/sidebar.tsx#SideBar"]={docgenInfo:SideBar.__docgenInfo,name:"SideBar",path:"src/components/molecules/Flow/sidebar.tsx#SideBar"})}catch(__react_docgen_typescript_loader_error){}var console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js"),Flow_jsx=react.createElement,initialElements=[{id:"1",type:"input",data:{label:"フレームワークを選択してください"},position:{x:250,y:5}}],id=0,getId=function getId(){return"dndnode_".concat(id++)},InnerFlow=function InnerFlow(_ref){var frameworks=_ref.frameworks,store=(0,esm.AC)(),reactFlowWrapper=(0,react.useRef)(null),_useNodesState=(0,esm.Rr)(initialElements),_useNodesState2=(0,slicedToArray.Z)(_useNodesState,2),nodes=_useNodesState2[0],setNodes=_useNodesState2[1],_useEdgesState=(0,esm.ll)([]),_useEdgesState2=(0,slicedToArray.Z)(_useEdgesState,2),edges=_useEdgesState2[0],setEdges=_useEdgesState2[1],_useState=(0,react.useState)(null),reactFlowInstance=_useState[0],setReactFlowInstance=_useState[1],deleteElements=(0,esm._K)().deleteElements,onNodesChange=(0,react.useCallback)((function(changes){setNodes((function(nds){return(0,esm.Fb)(changes,nds)})),console.log("onNodesChange called")}),[setNodes]),onEdgesChange=(0,react.useCallback)((function(changes){setEdges((function(eds){return(0,esm.yn)(changes,eds)})),console.log("onEdgesChange called")}),[setEdges]),onConnect=(0,react.useCallback)(function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(params){return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:console.log("onConnect called"),setEdges((function(eds){return(0,esm.Z_)(params,eds)}));case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref2.apply(this,arguments)}}(),[]),onDragOver=(0,react.useCallback)((function(event){event.preventDefault(),event.dataTransfer.dropEffect="move"}),[]),onDrop=(0,react.useCallback)((function(event){if(event.preventDefault(),null!=reactFlowWrapper.current){var reactFlowBounds=reactFlowWrapper.current.getBoundingClientRect(),data=JSON.parse(event.dataTransfer.getData("application/reactflow")),type=data.type;if(void 0!==type&&type){var position=reactFlowInstance.project({x:event.clientX-reactFlowBounds.left,y:event.clientY-reactFlowBounds.top}),newNode={id:getId(),type,position,data:{label:data.label?data.label:"N/A"}};setNodes((function(nds){return nds.concat(newNode)}))}}}),[reactFlowInstance,setNodes]),getClosestEdge=(0,react.useCallback)((function(node){var nodeInternals=store.getState().nodeInternals,closestNode=Array.from(nodeInternals.values()).reduce((function(res,n){if(n.id!==node.id){var dx=n.positionAbsolute.x-node.positionAbsolute.x,dy=n.positionAbsolute.y-node.positionAbsolute.y,d=Math.sqrt(dx*dx+dy*dy);d<res.distance&&d<150&&(res.distance=d,res.node=n)}return res}),{distance:Number.MAX_VALUE,node});if(!closestNode.node)return null;var closeNodeIsSource=closestNode.node.positionAbsolute.x<node.positionAbsolute.x;return{id:"".concat(node.id,"-").concat(closestNode.node.id),source:closeNodeIsSource?closestNode.node.id:node.id,target:closeNodeIsSource?node.id:closestNode.node.id,className:""}}),[store]),onNodeDrag=(0,react.useCallback)((function(_,node){var closeEdge=getClosestEdge(node);setEdges((function(es){var nextEdges=es.filter((function(e){return"temp"!==e.className}));return closeEdge&&!nextEdges.find((function(ne){return ne.source===closeEdge.source&&ne.target===closeEdge.target}))&&(closeEdge.className="temp",nextEdges.push(closeEdge)),nextEdges}))}),[getClosestEdge,setEdges]),onNodeDragStop=(0,react.useCallback)((function(_,node){var closeEdge=getClosestEdge(node);setEdges((function(es){var nextEdges=es.filter((function(e){return"temp"!==e.className}));return closeEdge&&nextEdges.push(closeEdge),nextEdges}))}),[getClosestEdge,setEdges]),onNodesDelete=(0,react.useCallback)((function(deleted){function removeTreeOfOutgoers(node){var outgoers=(0,esm.xA)(node,nodes,edges);console.log(outgoers),outgoers.length&&(deleteElements({nodes:outgoers}),outgoers.forEach((function(outgoer){removeTreeOfOutgoers(outgoer)})))}deleted.forEach((function(node){removeTreeOfOutgoers(node)}))}),[nodes,deleteElements,edges]);return Flow_jsx("div",{className:(0,css.iv)({flexDirection:"column",display:"flex",flexGrow:"1",height:"100%",md:{flexDirection:"row"}})},Flow_jsx("div",{className:(0,css.iv)({width:"100vw",height:"100vh"}),ref:reactFlowWrapper},Flow_jsx(esm.x$,{nodes,edges,onNodesChange,onEdgesChange,onNodeDrag,onNodeDragStop,onNodesDelete,onConnect,onInit:setReactFlowInstance,onDrop,onDragOver,fitView:!0},Flow_jsx(dist_esm.Z,null),Flow_jsx(minimap_dist_esm.a,null),Flow_jsx(background_dist_esm.A,{variant:background_dist_esm.T.Dots,gap:12,size:1}))),Flow_jsx(SideBar,{frameworks}))};InnerFlow.displayName="InnerFlow";var _Default$parameters,_Default$parameters2,Flow=function Flow(_ref3){var frameworks=_ref3.frameworks;return Flow_jsx(esm.tV,null,Flow_jsx(InnerFlow,{frameworks}))};Flow.displayName="Flow",Flow.__docgenInfo={description:"",methods:[],displayName:"Flow",props:{frameworks:{required:!0,tsType:{name:"sidebarData"},description:""}}};try{Flow.displayName="Flow",Flow.__docgenInfo={description:"",displayName:"Flow",props:{frameworks:{defaultValue:null,description:"",name:"frameworks",required:!0,type:{name:"sidebarData"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/molecules/Flow/Flow.tsx#Flow"]={docgenInfo:Flow.__docgenInfo,name:"Flow",path:"src/components/molecules/Flow/Flow.tsx#Flow"})}catch(__react_docgen_typescript_loader_error){}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const Flow_stories={title:"Flow",component:Flow,tags:["autodocs"],parameters:{layout:"fullscreen"},argTypes:{}};var _play,Default={args:{frameworks:{name:"frameworks",nodes:[]}},play:(_play=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(_ref){var canvasElement;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:canvasElement=_ref.canvasElement,(0,dist.uh)(canvasElement);case 2:case"end":return _context.stop()}}),_callee)}))),function play(_x){return _play.apply(this,arguments)})};Default.parameters=_objectSpread(_objectSpread({},Default.parameters),{},{docs:_objectSpread(_objectSpread({},null===(_Default$parameters=Default.parameters)||void 0===_Default$parameters?void 0:_Default$parameters.docs),{},{source:_objectSpread({originalSource:"{\n  args: {\n    frameworks: {\n      name: 'frameworks',\n      nodes: []\n    }\n  },\n  play: async ({\n    canvasElement\n  }) => {\n    const canvas = within(canvasElement);\n  }\n}"},null===(_Default$parameters2=Default.parameters)||void 0===_Default$parameters2||null===(_Default$parameters2=_Default$parameters2.docs)||void 0===_Default$parameters2?void 0:_Default$parameters2.source)})})},"?1f41":()=>{}}]);